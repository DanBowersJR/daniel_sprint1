<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="style.css" />
    <title>Cart - Gary's Breakfast Diner</title>
  </head>
  <body>
    <header>
      <div class="logo">
        Gary's Breakfast Diner
        <img src="Images/chefGary copy (1).jpg" class="avatar" alt="Avatar" />
      </div>
      <nav>
        <a class="menu-button" href="index.html">Home</a>
        <a class="order-button" href="menu.html">Menu</a>
      </nav>
    </header>

    <!-- Main section -->
    <main>
      <section>
        <h1>Your Cart</h1>
        <ul id="cart"></ul>

        <!-- Order Summary -->
        <div class="order-total">
          Subtotal: $0.00 <br />
          Tax (15%): $0.00 <br />
          <strong>Total: $0.00</strong>
        </div>

        <!-- Payment form -->
        <div id="payment-form">
          <form id="payment-form-content">
            <label for="card-name">Name:</label>
            <input type="text" id="card-name" name="card-name" required />
            <br />

            <label for="address">Address:</label>
            <input type="text" id="address" name="address" required />
            <br />

            <label for="phone">Phone Number:</label>
            <input
              type="tel"
              id="phone"
              name="phone"
              placeholder="123-456-7890"
              required
            />
            <br />

            <label for="card-number">Card Number:</label>
            <input
              type="text"
              id="card-number"
              name="card-number"
              placeholder="1234 5678 9012 3456"
              required
            />
            <br />

            <label for="expiry-date">Expiry Date (MM/YY):</label>
            <input
              type="text"
              id="expiry-date"
              name="expiry-date"
              placeholder="MM/YY"
              required
            />
            <br />

            <label for="cvv">CVV:</label>
            <input type="text" id="cvv" name="cvv" required />
            <br />

            <button
              type="button"
              id="pay-now-button"
              class="pay-now"
              onclick="processPayment()"
            >
              Pay Now
            </button>
          </form>
        </div>

        <div id="confirmation-message" style="display: none">
          <h2 class="payconfirm">Payment Confirmed!</h2>
          <p class="payconfirm">
            Your order will arrive within the next 30-45 minutes. Thank you for
            choosing Gary's!
          </p>
        </div>
      </section>
    </main>

    <footer>
      <p class="footer-text">
        Wake up happy at Gary's, where every bite brings a smile to your day!
      </p>
    </footer>

    <script>
      // functions
      function displayCartItems() {
        const cartItems = JSON.parse(localStorage.getItem("cartItems")) || [];
        const cartList = document.getElementById("cart");
        let subtotal = 0;

        cartList.innerHTML = "";

        cartItems.forEach((item, index) => {
          const listItem = document.createElement("li");
          listItem.innerHTML = `
          ${item.name} - $${item.price.toFixed(2)} x ${item.quantity}
          <button onclick="removeItem(${index})" class="remove-item">Remove</button>
        `;
          cartList.appendChild(listItem);
          subtotal += item.price * item.quantity;
        });

        calculateTotal(subtotal);
      }

      function calculateTotal(subtotal) {
        const taxRate = 0.15;
        const taxAmount = subtotal * taxRate;
        const total = subtotal + taxAmount;

        document.querySelector(".order-total").innerHTML = `
        Subtotal: $${subtotal.toFixed(2)} <br />
        Tax (15%): $${taxAmount.toFixed(2)} <br />
        <strong>Total: $${total.toFixed(2)}</strong>
      `;
      }

      function removeItem(index) {
        const cartItems = JSON.parse(localStorage.getItem("cartItems")) || [];
        cartItems.splice(index, 1);
        localStorage.setItem("cartItems", JSON.stringify(cartItems));
        displayCartItems();
      }

      function validatePaymentForm() {
        const cardNumber = document
          .getElementById("card-number")
          .value.replace(/\s+/g, "");
        const expiryDate = document.getElementById("expiry-date").value;
        const cvv = document.getElementById("cvv").value;
        const phoneNumber = document.getElementById("phone").value;
        const cardName = document.getElementById("card-name").value.trim();
        const address = document.getElementById("address").value.trim();
        const cardPattern = /^\d{16}$/;
        const expiryPattern = /^(0[1-9]|1[0-2])\/\d{2}$/;
        const cvvPattern = /^\d{3,4}$/;
        const phonePattern = /^\d{10}$/;

        // Validations

        if (!cardName) {
          alert("Name field cannot be blank.");
          return false;
        }

        if (!address) {
          alert("Address field cannot be blank.");
          return false;
        }

        if (!cardPattern.test(cardNumber)) {
          alert("Invalid credit card number. It should be exactly 16 digits.");
          return false;
        }

        if (!expiryPattern.test(expiryDate)) {
          alert("Invalid expiry date. Use MM/YY format.");
          return false;
        }

        if (!cvvPattern.test(cvv)) {
          alert("Invalid CVV. It should be 3 or 4 digits.");
          return false;
        }

        if (!phonePattern.test(phoneNumber.replace(/[^0-9]/g, ""))) {
          alert("Invalid phone number. It should be exactly 10 digits.");
          return false;
        }

        return true;
      }

      function processPayment() {
        if (validatePaymentForm()) {
          const confirmation = confirm(
            "Are you sure you want to proceed with the payment?"
          );

          if (confirmation) {
            document.getElementById("confirmation-message").style.display =
              "block";
          }
        }
      }

      document.addEventListener("DOMContentLoaded", displayCartItems);
    </script>
  </body>
</html>
